rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // DEVELOPMENT RULES - More permissive for testing
    // Replace with production rules before going live
    
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Simplified admin check for development
    function isAdmin() {
      return isAuthenticated() && 
             (request.auth.token.email == 'admin@arogyabmr.org' ||
              request.auth.token.email_verified == true);
    }
    
    // Users collection
    match /users/{userId} {
      allow read, write, create, delete: if isAuthenticated();
    }
    
    // Students collection - Main collection for student management
    match /students/{studentId} {
      allow read, write, create, delete, list: if isAuthenticated();
    }
    
    // Hero images for UI management
    match /heroImages/{imageId} {
      allow read: if true; // Public read access for website display
      allow write, create, delete, list: if isAuthenticated();
    }
    
    // UI content management
    match /uiContent/{contentId} {
      allow read: if true; // Public read access for website display
      allow write, create, delete, list: if isAuthenticated();
    }
    
    // Books collection
    match /books/{bookId} {
      allow read, write, create, delete, list: if isAuthenticated();
    }
    
    // Members collection
    match /members/{memberId} {
      allow read, write, create, delete, list: if isAuthenticated();
    }
    
    // Library transactions
    match /transactions/{transactionId} {
      allow read, write, create, delete, list: if isAuthenticated();
    }
    
    // News and content
    match /news/{newsId} {
      allow read: if true; // Public read access
      allow write, create, delete, list: if isAuthenticated();
    }
    
    // Events
    match /events/{eventId} {
      allow read: if true; // Public read access
      allow write, create, delete, list: if isAuthenticated();
    }
    
    // Media/Gallery
    match /media/{mediaId} {
      allow read: if true; // Public read access
      allow write, create, delete, list: if isAuthenticated();
    }
    
    // Contact forms and inquiries
    match /inquiries/{inquiryId} {
      allow read, write, create, delete, list: if isAuthenticated();
    }
    
    // Donations data
    match /donations/{donationId} {
      allow read: if true; // Public read for transparency
      allow write, create, delete, list: if isAuthenticated();
    }
    
    // Blood donors
    match /bloodDonors/{donorId} {
      allow read: if true; // Public read for emergency access
      allow write, create, delete, list: if isAuthenticated();
    }
    
    // Body donors
    match /bodyDonors/{donorId} {
      allow read, write, create, delete, list: if isAuthenticated();
    }
    
    // Financial donors
    match /financialDonors/{donorId} {
      allow read: if true; // Public read for transparency
      allow write, create, delete, list: if isAuthenticated();
    }
    
    // System settings and configuration
    match /settings/{settingId} {
      allow read, write, create, delete, list: if isAuthenticated();
    }
    
    // Audit logs
    match /auditLogs/{logId} {
      allow read, write, create, delete, list: if isAuthenticated();
    }
  }
}